# VANTAGE
## General Comments
This codebase is based around the test types used for the 2018-2019 development cycle. These included three types:
1. Simulation Testing
The simulation test was created using a combination of Cinema4D and Blensor, for the purpose of simulation the optical and TOF cameras, respectively. This suite ([VANTAGE_Simulation](https://github.com/vantagecu/VANTAGE_Simulation)) can be found in the [VANTAGE organization](https://github.com/vantagecu) repo. The truth data for this test is generated by the Cinema4D program itself.

2. Modular Testing
The modular test was developed for the purpose of testing the VANTAGE system from 0-10m. This test was performed in the CU RECUV lab, with truth data acquired using a system of VICON cameras.

3. 100m Testing
The 100m test was developed for the purpose of testing the system across the full 0-100m required range. This test was performed at the Boulder airport, using a test rig based on attaching CubeSats to a car, and acquiring truth data by affixing a GPS Trimble system to the car.

### Data Directory
The organization of the data directory (*VANTAGE/Data/*) is crucial for the successful operation of the VANTAGE software suite. The majority of errors that will be encountered when running the suite will be due to incorrectly configured data folders. The data directory is currently configured to handle the three types of tests used in the 2018-2019 development cycle. To ensure the correct configuration of the data:

Create a folder *Data/* within the main VANTAGE folder. This is excluded by .git in the .gitignore, so all data to be processed will downloaded and stored individually on your local machine. When the software suite has been fully set up and run, the Data directory will have the following folders:
Simulation/
truthMats/
Results/
ErrorOut/
ModularTest_4_9/
3_25_100m/

These should contain the following:
#### Simulation/
The simulation folder will have subfolders describing the type, date, and speed of the test. An example of this is: *Simulation_4_15_030*, which represents a test taken on April 15, at 0.30m/s. Within each of these subdirectories should be two folders, *Optical/* and *TOF/*. It will also have a *truth.json* file, and a *truth_corrected.json*, which is the truth file VANTAGE will process. In the case of the simulation, optical data should have naming conventions of a prefix *VTube*, and a timestamp suffix. If using the VANTAGE simulation software suite, this convention will automaticall be generated in the output. The TOF data should have multiple samples (taken with randomized noise), so it will have subdirectories of convention *Sample*. These files will then be prefixed with *Sample*, and suffixed with a timestamp and frame stamp.

## Configs
There are folders corresponding to each of the three tests used by VANTAGE, configured as *3_25_100m*, *ModularTest_4_9*, and *Simulation*. Within each of these folders will be subdirectories corresponding to individual tests run on those dates.
1. Modular
Sample folder: *Test5/*
2. 100m
Sample folder: *Test5/*
3. Simulation
Sample folder: *_030/Sample1* (for 0.30m/s)
Each of these folders will then contain configuration files, as described below:
### Deployer.json

### Manifest.json
This is a sample of the file that would be delivered to the VANTAGE system by an operator of the NanoRacks deployer. It contains descriptions of the cubesats to be deployed as well as deployment geometry. It also contains the expected release time of the cubesats. Additionally, it should contain a filepath to the truth data json and the test scenario.
DeploymentTube: tube number from which cubesats are expected to deploy.
VantageTube: tube that is occupied by VANTAGE system.
expectedRelease: datetime array containing expected release time.
CubesatArray: array containing data for each cubesat to be deployed.
  name: cubesat name.
  rangeOrder: order in which this cubesat will exit the tube.
  expectedU: expected cubesat size in U.
  actualDims: the actual dimensions of the cubesat in meters.
TruthDataFile: filepath to truth data file (.json).
testScenario: test scenario being run ('modular', '100m', or 'simulation')

### Optical.json

### Sensors.json
TOFData: Directory pointing to the TOF data for the current test to be run.
OpticalFocalLength: Focal length of optical camera (m).

### TOF.json

### Transform.json

### Validate.json
CorrelateTruthData: Boolean for whether to perform timestamp alignment. This should always remain on, unless you really don't want to generate a new file.
ComputingResults: Originally used for turning off result processing, but is now always on (except in the VANTAGE_main, where the process is automated and plotting is not desired).

## Tools
Miscellaneous tools can be found in the [MiscTools](https://github.com/DylanBossie-CU/VANTAGE/tree/master/MiscTools) directory.
### tofCropping
This directory contains the GUI used for cropping TOF point clouds. An example of the directory structure required is included. The GUI specifically looks for this directory to be called "Data". Run croppingGUI.m to crop point clouds.

### PlotCubeSats
This tool is used to generate 3D scatter plots of the first CubeSat launched for a given test type. Output figures will then be saved to *FigureOut/*.
The script is currently configured to plot for three specific tests:
1. Simulation Test (4-15 0.85m/s)
2. Modular Test (4-9)
3. 100m Test (3-25)

To configure which test is run, modify *testType (line 4)* to match one of the switch cases.

### truthCorrections_matGenerator
This tool is used to update the output *dataStruct* truth variable created in *Validate.m (line 467)* to .mat files to cooperate with the *VANTAGE.masterPlotter()* function. It will search for each of the three types of test cases in the *VANTAGE/Data/* directory, and create a *dataStruct* .mat variable which contains truth data for later processing.
To utilize this script, define the correct data directories in the beginning of the file which points to the location of the corrected truth data files.

### PlotTOFPointClouds
This uses the built in *pcshow()* function in MATLAB to display raw pointcloud files.
To utilize this script, define a directory which contains point clouds, and define the correct suffix in the *PointClouds* variable in line 13.

### RewriteDataStructVelocity
This script reads dataStruct output files, and transposes the velocity vector as needed to be processed in *masterPlotter()*.
